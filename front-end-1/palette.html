<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        canvas {
            border: 1px solid #333;
        }

    </style>
</head>
<body>
<canvas id="palette" width="360" height="150"></canvas>
<canvas id="color"></canvas>
<canvas id="pen" width="500" height="500"></canvas>
<input type="range" id="pen-px" min="1" max="100">
<script>
    const paletteCvs = document.querySelector("#palette");
    const paletteCtx = paletteCvs.getContext("2d");

    for (let i = 0; i < 360; i++) {
        const gradient = paletteCtx.createLinearGradient(i, 0, i + 1, paletteCvs.height);

        gradient.addColorStop(0, 'black');
        gradient.addColorStop(0.5, `hsl(${i}, 100%, 50%)`);
        gradient.addColorStop(1, "white");

        paletteCtx.fillStyle = gradient;
        paletteCtx.fillRect(i, 0, 1, paletteCvs.height);
    }

    const colorCvs = document.querySelector("#color");
    const colorCtx = colorCvs.getContext("2d");

    let isSelecting = false

    paletteCvs.addEventListener('mousedown', (e) => {
        isSelecting = true
        const x = e.offsetX
        const y = e.offsetY
        const imageData = paletteCtx.getImageData(x, y, 1, 1);
        const [r, g, b, a] = imageData.data
        colorCtx.fillStyle = `rgba(${r}, ${g}, ${b}, ${a})`
        colorCtx.fillRect(0, 0, colorCvs.width, colorCvs.height);
        penCtx.strokeStyle = `rgba(${r}, ${g}, ${b}, ${a})`
    })

    paletteCvs.addEventListener('mousemove', e => {
        if (isSelecting) {
            const x = e.offsetX
            const y = e.offsetY
            const imageData = paletteCtx.getImageData(x, y, 1, 1);
            const [r, g, b, a] = imageData.data
            colorCtx.fillStyle = `rgba(${r}, ${g}, ${b}, ${a})`
            colorCtx.fillRect(0, 0, colorCvs.width, colorCvs.height);
            penCtx.strokeStyle = `rgba(${r}, ${g}, ${b}, ${a})`
        }
    })

    paletteCvs.addEventListener('mouseup', () => {
        isSelecting = false
    })

    const penCvs = document.querySelector("#pen");
    const penPx = document.querySelector("#pen-px");
    const penCtx = penCvs.getContext("2d");
    penCtx.lineCap = 'round'
    penCtx.lineJoin = "round"

    let ispening = false
    let penX = 0
    let penY = 0

    penCvs.addEventListener('mousedown', e => {
        penX = e.offsetX
        penY = e.offsetY
        ispening = true
        penCtx.beginPath()
    })

    penCvs.addEventListener('mousemove', e => {
        if (ispening) {
            const x = e.offsetX
            const y = e.offsetY
            penCtx.lineWidth = penPx.value
            penCtx.moveTo(penX, penY)
            penCtx.lineTo(x, y)
            penCtx.stroke()
            penX = e.offsetX
            penY = e.offsetY
        }
    })

    window.addEventListener('mouseup', (e) => {
        ispening = false
    })
</script>
</body>
</html>